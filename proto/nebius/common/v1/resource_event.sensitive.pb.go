// Code generated by protoc-gen-sensitive. DO NOT EDIT.

package v1

import (
	proto "google.golang.org/protobuf/proto"
	protoreflect "google.golang.org/protobuf/reflect/protoreflect"
	anypb "google.golang.org/protobuf/types/known/anypb"
	slog "log/slog"
)

// Sanitize mutates [ResourceEvent] to remove/mask all sensitive values.
// Sensitive fields are marked with [(nebius.sensitive) = true].
//
// It also sanitizes the content of google.protobuf.Any, i.e. performs unmarshal, sanitize, marshal cycle.
// Important: [proto.UnmarshalOptions.DiscardUnknown] = true is used.
// In case of an error, the content of Any is replaced with google.protobuf.Empty.
func (x *ResourceEvent) Sanitize() {
	if x == nil {
		return
	}
	sanitizeAny := func(a *anypb.Any) {
		if a == nil {
			return
		}
		p, err := anypb.UnmarshalNew(a, proto.UnmarshalOptions{DiscardUnknown: true})
		if err != nil {
			a.TypeUrl = "type.googleapis.com/google.protobuf.Empty"
			a.Value = nil
			return
		}
		if s, ok := p.(interface{ Sanitize() }); ok {
			s.Sanitize()
		}
		err = a.MarshalFrom(p)
		if err != nil {
			a.TypeUrl = "type.googleapis.com/google.protobuf.Empty"
			a.Value = nil
		}
	}
	for _, y := range x.Error.GetDetails() {
		sanitizeAny(y)
	}
}

// LogValue implements [slog.LogValuer] interface. It returns sanitized copy of [ResourceEvent].
// Properly implemented [slog.Handler] must call LogValue, so sensitive values are not logged.
// Sensitive strings and bytes are masked with "**HIDDEN**", other sensitive fields are omitted.
//
// It also sanitizes the content of google.protobuf.Any, i.e. performs unmarshal, sanitize, marshal cycle.
// Important: [proto.UnmarshalOptions.DiscardUnknown] = true is used.
// In case of an error, the content of Any is replaced with google.protobuf.Empty.
//
// Returning value has kind [slog.KindAny]. To extract [proto.Message], use the following code:
//
//	var original *ResourceEvent
//	sanitized := original.LogValue().Any().(proto.Message)
//
// If you need to extract [ResourceEvent], use the following code:
//
//	var original *ResourceEvent
//	sanitized := original.LogValue().Any().(proto.Message).ProtoReflect().Interface().(*ResourceEvent)
func (x *ResourceEvent) LogValue() slog.Value {
	if x == nil {
		return slog.AnyValue(x)
	}
	c := proto.Clone(x).(*ResourceEvent) // TODO: generate static cloner without protoreflect
	c.Sanitize()
	return slog.AnyValue((*wrapperResourceEvent)(c))
}

// wrapperResourceEvent is used to return [ResourceEvent] not implementing [slog.LogValuer] to avoid recursion while resolving.
type wrapperResourceEvent ResourceEvent

func (w *wrapperResourceEvent) String() string {
	return (*ResourceEvent)(w).String()
}

func (*wrapperResourceEvent) ProtoMessage() {}

func (w *wrapperResourceEvent) ProtoReflect() protoreflect.Message {
	return (*ResourceEvent)(w).ProtoReflect()
}
